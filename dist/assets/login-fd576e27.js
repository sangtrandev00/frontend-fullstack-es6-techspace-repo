import"./axiosClient-bd54c5dc.js";import"./main-0ae8c9b5.js";import{A as s}from"./authApi-bb3dd306.js";import{G as p,s as w,a as y}from"./firebase-config-abc45bc9.js";import"./helper-06e4e79d.js";const h=async()=>{const e=document.getElementById("login-form");e&&e.addEventListener("submit",async o=>{o.preventDefault();const t=o.target.elements.email.value,n=o.target.elements.password.value,l={email:t,password:n},{message:c,token:r,userId:i}=await s.login(l),a=new Date(Date.now()+60*60*1e3);console.log("Expiry Date",a),console.log(c),localStorage.setItem("userId",i),localStorage.setItem("token",r),localStorage.setItem("expiryDate",a),location.assign("./index.html")})},D=async()=>{const e=new p;try{const{providerId:o,user:t}=await w(y,e),{displayName:n,email:l,phoneNumber:c,photoURL:r,stsTokenManager:{accessToken:i,expirationTime:a,refreshToken:b}}=t,{message:u,result:g}=await s.checkExisingUser({email:l,providerId:o});if(console.log(u,g),g==="not found"){const f=await s.signup({providerId:o,name:n,email:l,avatar:r,password:"google.com",role:"client"});console.log(f)}const{mesasge:E,token:d,userId:I}=await s.googleLogin({token:i}),m=new Date(Date.now()+60*60*1e3);console.log("Expiry Date",m),localStorage.setItem("userId",I),localStorage.setItem("token",d),localStorage.setItem("expiryDate",m),location.href="index.html"}catch(o){const t=o.code,n=o.message;console.log("Error:",t,n)}},k=()=>{const e=new Date,o=localStorage.getItem("expiryDate");e>o&&(localStorage.removeItem("expiryDate"),localStorage.removeItem("token"),localStorage.removeItem("userId"))},x=()=>{const e=document.getElementById("google-signin-btn");e&&e.addEventListener("click",o=>{D()})};(async()=>(k(),await h(),x()))();function S(e){console.log("statusChangeCallback"),console.log(e),e.status==="connected"?v(e):document.getElementById("status").innerHTML="Please log into this webpage."}window.fbAsyncInit=function(){FB.init({appId:"984824306042759",cookie:!0,xfbml:!0,version:"v17.0"}),FB.getLoginStatus(function(e){S(e)})};function v(e){console.log("Welcome!  Fetching your information.... "),FB.api("/me",async function(o){console.log("Information: ",o),console.log("userData",e);const{name:t,id:n}=o;if((await s.checkExistedFbAccount({name:t,fbUserId:n})).result==="not found"){const a=await s.signup({name:t,fbUserId:n});console.log(a)}const{message:c,userId:r,token:i}=await s.facebookLogin({name:t,fbUserId});if(r){const a=new Date(Date.now()+36e5);localStorage.setItem("userId",r),localStorage.setItem("token",i),localStorage.setItem("expiryDate",a)}location.href="index.html",console.log("Successful login for: "+o.name),document.getElementById("status").innerHTML="Thanks for logging in, "+o.name+"!"})}
