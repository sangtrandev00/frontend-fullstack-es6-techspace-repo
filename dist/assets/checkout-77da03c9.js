import{a as W}from"./axiosClient-bd54c5dc.js";import"./main-0ae8c9b5.js";import{e as R,N as F,m as _,n as J,k,S as B,i as v,P as U}from"./helper-06e4e79d.js";const h=W.create({baseURL:"https://dev-online-gateway.ghn.vn/shiip/public-api",headers:{"Content-Type":"application/json"}});h.interceptors.request.use(function(e){const t=localStorage.getItem("access_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},function(e){return Promise.reject(e)});h.interceptors.response.use(function(e){return e.data},function(e){if(!e.response)throw new Error("Network error. Please try again later.");if(e.response.status===401){window.location.assign("/login.html");return}throw new Error(e)});const E="66961f68-cc3c-11ed-943b-f6b926345ef9";class L{static getProvinces(){const t="/master-data/province";return h.get(t,{headers:{Token:E}})}static getProvinceById(){}static getDistricts(t){const s="/master-data/district";return h.post(s,t,{headers:{Token:E}})}static getWards(t){const s=`/master-data/ward?district_id=${t}`;return h.get(s,{headers:{Token:E}})}}R({Select:F});const V=JSON.parse(localStorage.getItem("cart")),P=localStorage.getItem("userId"),D=document.getElementById("selectProvince"),b=document.getElementById("selectDistrict"),z=document.getElementById("selectWard"),A=V.cartList,G=document.querySelector(".default-shipping-el"),y=document.querySelector(".default-shipping-input"),N=document.getElementById("radioDefault02"),Q=document.getElementById("radioDefault01"),T=document.getElementById("view-cart");document.querySelector(".new-shipping-el");const $=document.querySelector(".new-shipping-address-select-el"),Y=document.getElementById("checkoutMethod1"),K=document.getElementById("checkoutMethod2"),X=async()=>{T.innerHTML="",_(A,T,Z);const{totalPrice:e,cartLength:t}=J(A),s=e+8;if(k("subtotal",`$${e.toFixed(2)}`),k("allTotal",`$${s.toFixed(2)}`),!P){N.checked=!0;return}G.classList.remove("hidden"),y.classList.remove("hidden"),$.classList.add("hidden");const{user:n,message:o}=await B.getUserById(P),{email:c,name:a,payment:i,address:d,phone:r}=n;v("email",c),v("fullName",a),v("phone",r),v("default-shipping-input",d)},Z=(e,t,s,n,o,c,a)=>`
        <div prod-id=${e} class="flex flex-col rounded-lg bg-white sm:flex-row">
            <img class="m-2 h-24 w-28 rounded-md border object-cover object-center"
                src="http://localhost:8080/${s}"
                alt="${t}" />
            <div class="flex w-full flex-col px-4 py-4">
                <span class="font-semibold">${t}</span>
                <span class="float-right text-gray-400">Qty: ${o}, Price/item: $${c}</span>
                <p class="text-lg font-bold">Total item: $${a}</p>
            </div>
        </div>
      `,ee=async()=>{const e=document.getElementById("order-form");e&&e.addEventListener("submit",async t=>{t.preventDefault(),console.log("submited!");const s=t.target.elements,n=document.querySelectorAll("input[data-te-select-input-ref]");let o="";N.checked?o=[...n].map(m=>m.value).join(", "):Q.checked&&(o=y.value);const c=s.email.value,a=s.fullName.value,i=s.phone.value,d=s.note.value;let r="COD";Y.checked?r="COD":K.checked&&(r="VNPAY");const u={email:c,fullName:a,phone:i,shippingAddress:o},f=JSON.parse(localStorage.getItem("cart")),p={items:[],totalPrice:0},I=f.cartList.map(async m=>{const{prodId:g,qty:M}=m;try{const{product:{name:S,oldPrice:O,discount:j,thumbnail:H}}=await U.getById(g),l={};return l.prodId=g,l.qty=M,l.name=S,l.price=O*(1-j/100),l.image=H,l}catch(S){console.log(S)}});p.totalPrice=f.cartList.reduce((m,g)=>m+g.qty*g.price,0);const w=await Promise.all(I);p.items=w;const x={paymentMethod:r,note:d,user:u,products:p},C=await B.createOrder(x),{message:te,order:{_id:q}}=C;localStorage.removeItem("cart"),location.assign(`./order-completed.html?id=${q}`)})};(async()=>{await X(),await ee();const{code:e,data:t}=await L.getProvinces();for(const n of t){const{ProvinceID:o,ProvinceName:c}=n,a=`<option value="${o}">${c}</option>`;D.insertAdjacentHTML("beforeend",a)}D.addEventListener("valueChange.te.select",async n=>{const o=n.target.value,{data:c,code:a}=await L.getDistricts({province_id:+o});for(const i of c){const{DistrictID:d,DistrictName:r}=i,u=`<option value=${d}>${r}</option>`;b.insertAdjacentHTML("beforeend",u)}b.addEventListener("valueChange.te.select",async i=>{const d=i.target.value,{code:r,data:u}=await L.getWards(d);for(const f of u){const{WardID:p,WardName:I}=f,w=`<option value=${p}>${I}`;z.insertAdjacentHTML("beforeend",w)}})});const s=document.querySelectorAll("input[name='shippingRadioInput']");for(const n of s)n.addEventListener("click",o=>{o.target.checked&&(console.log("Oke",o.target.id),o.target.id==="radioDefault01"?($.classList.add("hidden"),y.classList.remove("hidden")):o.target.id==="radioDefault02"&&(y.classList.add("hidden"),$.classList.remove("hidden")))})})();
